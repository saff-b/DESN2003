<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/svg.js/3.1.2/svg.min.js"></script>
    <script src="daily_boarding.js"></script>

    <style media="screen">
        .line{
            fill:none;
            stroke:black;
            width: 1;
        }
        .background{
            fill:#0c0e31;
        }
    </style>
</head>
<body>
    <script>
    dw = 1080;
    dh = 1920;
    var draw = SVG().addTo("body").size(dw,dh);
    
    var background = draw.rect(dw,dh)
        .addClass("background");

    var target_year = 2018;
    var padding = 0;
    var interval = ((dw - 100) / 12);
    var lines = [];
    var scale = 0.0005;
    var baseline = 1500;
    var points = [];
    boarding_data.forEach(d => {
            x_pos = (d.month * interval);
            y_pos = baseline - (d.sum * scale);

            points.push([x_pos,y_pos]);
        if (d.month == 12 || (d.Year == 2022 && d.month == 6)) {
            lines.push(points);
            points = [];
        }
    })
    
    var timeline = new SVG.Timeline();
    var gr = draw.group();
    for (var i = 1; i < 9; i++) {
        var speed = 100;
        var thickness = 20;
        var order = (i - 1) * speed * 12;
        if (i != 8) {
        animate_plot(gr, lines[i], speed, order, thickness, '#354bbd', '#63cdeb');
        } else {
            animate_plot(gr, lines[i], speed, order, thickness, '#354bbd', '#63cdeb', true);
        }
    }

    function animate_plot(group, plot, speed, order, thickness, dotcol, linecol, last) {
        for (var i = 1; i < plot.length; i++) {
            var line = group.line([plot[i - 1], plot[i - 1]]).stroke({ color: dotcol, opacity: '0.0', width: thickness, linecap: 'round' });
            var pointline = group.line([plot[i - 1], plot[i - 1]]).stroke({ color: linecol, opacity: '0.0', width: thickness, linecap: 'round' });
            line.timeline(timeline);
            pointline.timeline(timeline);
            pointline.animate(1,(i*speed) + order, 'absolute').stroke({opacity:1})
                .animate(speed,0).plot([plot[i],plot[i]])
                .animate(0,0).stroke({opacity:0});
            line.animate(1,(i * speed) + order, 'absolute').stroke({opacity:1})
                .animate(speed,(i*speed) + order,'absolute').plot([plot[i-1],plot[i]]);
    }            
    if (!last) {
        var cover = group.rect(dw - 130,1000).opacity(0).move(60,400).radius(30).fill('#fff'); //0c0e31
        cover.animate(100,(plot.length+1)*speed+order,'absolute').opacity(0.1);
    }
    }

    </script>
</body>
</html>